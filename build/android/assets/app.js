function appStart(){if(Facebook.getLoggedIn()){console.log("fbLoggedIn"),Cloud.SocialIntegrations.externalAccountLogin({type:"facebook",token:Facebook.accessToken},function(e){e.success?Facebook.requestWithGraphPath("/me",{fields:"id, name, first_name, middle_name, last_name, email, picture"},"GET",function(e){if(e.success){var o=JSON.parse(e.result);console.log("User Login Success"),alert(o.name+"("+o.id+")\n"+o.email+"\n"+o.picture.data.url);var n={email:o.email,first_name:o.first_name,last_name:o.last_name,custom_fields:{facebook_id:o.id,facebook_pic:o.picture.data.url}};Cloud.Users.update(n,function(e){e.success&&console.log("User Info Updated")})}else console.log(e.error?"Error: \n"+e.error:"Unknown response")}):alert("Error:\n"+(e.error&&e.message||JSON.stringify(e)))});var e=require("/ui/HomeWindow");appRoot=new RootWindow(new e),appRoot.open()}else{console.log("fbNotLoggedIn");var o=require("/ui/LoginWindow");appRoot=new RootWindow(new o),appRoot.open()}}Ti.UI.setBackgroundColor("#fff");var RootWindow=require("/ui/RootWindow"),Cloud=require("ti.cloud"),Facebook=require("facebook");Facebook.initialize(1e3),Facebook.permissions=["email","public_profile","user_friends"],Facebook.addEventListener("login",function(){appStart()}),Facebook.addEventListener("logout",function(){appStart()}),appStart();